<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:Cas van Cooten]"><meta name=description content="Wow, been a while since my last blog ðŸ˜…. During some research I came across a technique variation which I felt was interesting enough to share in a brief blog post. It relates to how the bootstrapping functionality in VS Code can be abused to quietly load plugins - it may come in handy during your initial access adventures!
The Threat of VS Code Extensions It&rsquo;s no secret that the popularity of VS Code brings a lot of risk exposure in the form of its plugin system. Threat actors and researchers alike have been happily abusing it to target developers - even your favorite dark theme is not safe.
"><meta name=keywords content="homepage,blog,cas van cooten,security,hacking,VS Code,Offensive Security,Initial Access,Red Team"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://casvancooten.com/posts/2025/02/abusing-vs-codes-bootstrapping-functionality-to-quietly-load-malicious-extensions/><title>Abusing VS Code's Bootstrapping Functionality To Quietly Load Malicious Extensions :: Cas van Cooten
</title><link rel=stylesheet href=/main.min.244183cde1a38e0b08f82c11791181288f9aac1cc9618cd6f4e9e7710c5768ba.css integrity="sha256-JEGDzeGjjgsI+CwReRGBKI+arBzJYYzW9OnncQxXaLo=" crossorigin=anonymous><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Abusing VS Code's Bootstrapping Functionality To Quietly Load Malicious Extensions"><meta itemprop=description content="Wow, been a while since my last blog ðŸ˜…. During some research I came across a technique variation which I felt was interesting enough to share in a brief blog post. It relates to how the bootstrapping functionality in VS Code can be abused to quietly load plugins - it may come in handy during your initial access adventures!
The Threat of VS Code Extensions Itâ€™s no secret that the popularity of VS Code brings a lot of risk exposure in the form of its plugin system. Threat actors and researchers alike have been happily abusing it to target developers - even your favorite dark theme is not safe."><meta itemprop=datePublished content="2025-02-27T00:00:00+00:00"><meta itemprop=dateModified content="2025-02-28T16:46:44+01:00"><meta itemprop=wordCount content="1183"><meta itemprop=image content="https://casvancooten.com/preview.png"><meta itemprop=keywords content="VS Code,Offensive Security,Initial Access,Red Team"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://casvancooten.com/preview.png"><meta name=twitter:title content="Abusing VS Code's Bootstrapping Functionality To Quietly Load Malicious Extensions"><meta name=twitter:description content="Wow, been a while since my last blog ðŸ˜…. During some research I came across a technique variation which I felt was interesting enough to share in a brief blog post. It relates to how the bootstrapping functionality in VS Code can be abused to quietly load plugins - it may come in handy during your initial access adventures!
The Threat of VS Code Extensions Itâ€™s no secret that the popularity of VS Code brings a lot of risk exposure in the form of its plugin system. Threat actors and researchers alike have been happily abusing it to target developers - even your favorite dark theme is not safe."><meta property="og:url" content="https://casvancooten.com/posts/2025/02/abusing-vs-codes-bootstrapping-functionality-to-quietly-load-malicious-extensions/"><meta property="og:site_name" content="Cas van Cooten"><meta property="og:title" content="Abusing VS Code's Bootstrapping Functionality To Quietly Load Malicious Extensions"><meta property="og:description" content="Wow, been a while since my last blog ðŸ˜…. During some research I came across a technique variation which I felt was interesting enough to share in a brief blog post. It relates to how the bootstrapping functionality in VS Code can be abused to quietly load plugins - it may come in handy during your initial access adventures!
The Threat of VS Code Extensions Itâ€™s no secret that the popularity of VS Code brings a lot of risk exposure in the form of its plugin system. Threat actors and researchers alike have been happily abusing it to target developers - even your favorite dark theme is not safe."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-27T00:00:00+00:00"><meta property="article:modified_time" content="2025-02-28T16:46:44+01:00"><meta property="article:tag" content="VS Code"><meta property="article:tag" content="Offensive Security"><meta property="article:tag" content="Initial Access"><meta property="article:tag" content="Red Team"><meta property="og:image" content="https://casvancooten.com/preview.png"><meta property="article:published_time" content="2025-02-27 00:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>Security Ramblings</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/posts/>Blog</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
6 minutes</p></div><article><h1 class=post-title><a href=https://casvancooten.com/posts/2025/02/abusing-vs-codes-bootstrapping-functionality-to-quietly-load-malicious-extensions/>Abusing VS Code&rsquo;s Bootstrapping Functionality To Quietly Load Malicious Extensions</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#the-threat-of-vs-code-extensions>The Threat of VS Code Extensions</a></li><li><a href=#vs-code-extensions-for-initial-access>VS Code Extensions for Initial Access</a></li><li><a href=#vs-codes-bootstrap-feature>VS Code&rsquo;s &ldquo;Bootstrap&rdquo; Feature</a></li><li><a href=#making-it-portable>Making It Portable</a></li><li><a href=#prevention-and-detection>Prevention and Detection</a></li></ul></nav></aside><hr><div class=post-content><p>Wow, been a while since my last blog ðŸ˜…. During some research I came across a technique variation which I felt was interesting enough to share in a brief blog post. It relates to how the bootstrapping functionality in VS Code can be abused to quietly load plugins - it may come in handy during your initial access adventures!</p><h2 id=the-threat-of-vs-code-extensions>The Threat of VS Code Extensions</h2><p>It&rsquo;s no secret that the popularity of VS Code brings a lot of risk exposure in the form of its plugin system. <a href=https://unit42.paloaltonetworks.com/stately-taurus-abuses-vscode-southeast-asian-espionage/>Threat actors</a> and <a href=https://www.bleepingcomputer.com/news/security/malicious-vscode-extensions-with-millions-of-installs-discovered/>researchers</a> alike have been happily <a href=https://arxiv.org/html/2411.07479v1>abusing it</a> to <a href=https://www.reversinglabs.com/blog/malicious-helpers-vs-code-extensions-observed-stealing-sensitive-information>target developers</a> - <a href=https://www.bleepingcomputer.com/news/security/vscode-extensions-with-9-million-installs-pulled-over-security-risks/>even your favorite dark theme is not safe</a>.</p><p>Of course, this type of threat is inherent to allowing untrusted (or <em>semi-trusted?</em>) code to run within a trusted process. As attackers, it&rsquo;s very enticing to be able to run our own code inside of the trusted, signed, and highly prevalent process &ldquo;Code.exe&rdquo;. This process is also known to perform a variety of activities, like call out to the Internet, spawn shells as child processes, and continually interact with local and remote filesystems. This makes it hard for defenders to fingerprint what constitutes benign versus malicious behavior, and by extension makes it easier for us as attackers to &ldquo;blend in&rdquo; with the noise.</p><p>Creating malicious Code extensions is outside of the scope of this post. However, creating custom VS Code extensions is easy, the team even has a great <a href=https://code.visualstudio.com/api/get-started/your-first-extension>getting started guide</a> for it. You&rsquo;ll manage. ðŸ˜‰</p><h2 id=vs-code-extensions-for-initial-access>VS Code Extensions for Initial Access</h2><p>(Un)fortunately, getting a malicious plugin installed is not as arbitrary as it may seem. Clearly, the VS Code team is aware of this threat, and a <a href=https://code.visualstudio.com/docs/editor/extension-runtime-security>number of measures</a> are taken to reduce the risk of a malicious extension inadvertently being installed. There are however several ways of increasing the likelihood of a successful installation: the team over at MDSec has an excellent <a href=https://www.mdsec.co.uk/2023/08/leveraging-vscode-extensions-for-initial-access/>blog post highlighting various delivery techniques including the VS Code URL handler</a> that still work today. Even so, getting a user to install your plugin triggers various prompts that require some clever social engineering to navigate. In the recent January release, the VS Code team <a href=https://code.visualstudio.com/updates/v1_97#_trusting-extension-publishers>added yet another prompt</a> that needs to be accepted for every plugin publisher:</p><p><img src=/images/vscode-publishertrust.png alt="VS Code&rsquo;s new &ldquo;Publisher Trust&rdquo; prompt"></p><h2 id=vs-codes-bootstrap-feature>VS Code&rsquo;s &ldquo;Bootstrap&rdquo; Feature</h2><p>However, there is a trick to get around these prompts and quietly install your plugin. This trick comes in the form of VS Code&rsquo;s bootstrapping functionality, which enables enterprise users to <a href=https://code.visualstudio.com/docs/setup/enterprise#_set-up-vs-code-with-preinstalled-extensions>install new instances of VS Code with pre-packaged extensions</a>. As the documentation describes, bootstrapping a new install of VS Code is as simple as creating a <code>./bootstrap/extensions</code> folder within your VS Code installation directory and dropping the <code>.vsix</code> (extension) files in there. This installs the extension(s) on first boot, bypassing any prompts (including the new publisher trust prompt). This has the added benefit of not requiring the extension to originate from the marketplace, which is obviously a great thing when deploying malicious extensions as it bypasses the need for publisher or security checks.</p><p><img src=/images/vscode-bootstrapextensionfile.png alt="Easy as dropping a file in the VS Code directory!"></p><p>However, there is an issue with this method. While it works well for a &ldquo;Bring-Your-Own&rdquo; installation of VS Code, it does <em>not</em> work on systems where VS Code is already installed. This is because the ExtensionsInitializer (<a href=https://github.com/microsoft/vscode/blob/main/src/vs/code/electron-utility/sharedProcess/contrib/defaultExtensionsInitializer.ts>source</a>) stores a value in the <code>StorageTarget.Machine</code> field, which is machine-specific (on Windows it equates to <code>%AppData%\Code</code>). This field ensures the ExtensionsInitializer only runs on first boot, meaning we are out of luck if the key is set on subsequent runs. Or are we?</p><blockquote><p><strong>Note:</strong> Removing the <code>%AppData%\Code</code> directory does &ldquo;reset&rdquo; the settings in <code>StorageTarget.Machine</code>, and makes it so the bootstrap functionality works even for users who have extensions configured in their user profile (which is typically in <code>%USERPROFILE%\.vscode</code>), merging the bootstrapped extensions with their own. However, this directory contains other important configuration data such as the <code>settings.json</code> file, so taking this approach is not recommended. If you want to persist within a user&rsquo;s existing profile, backdooring the user&rsquo;s <code>extensions.json</code> is probably the better route.</p></blockquote><h2 id=making-it-portable>Making It Portable</h2><p>To bootstrap extensions on a machine where VS Code is already installed and initialized, we can (ab)use VS Code&rsquo;s &ldquo;portable&rdquo; functionality. As described on <a href=https://code.visualstudio.com/docs/editor/portable>this page</a>, a VS Code installation becomes portable simply when a <code>./data</code> directory exists within it. If this is the case, it will use this directory to store both user AND machine preferences. This means that if this directory is empty, VS Code will assume it is a new installation and trigger the bootstrapping process!</p><p>This unlocks a variety of attack scenarios that could be interesting for initial access or persistence. An attacker could use the legitimate VS Code installation zip (or bring their own), and simply inject the <code>./data</code> and <code>./bootstrap/extensions</code> directories to silently install and run the malicious extension. Alternatively, bootstrapping could be abused to inject an extension in the user&rsquo;s existing VS Code installation (see caveat below), then use the extension to restore the user&rsquo;s normal environment. All without any prompts or warnings!</p><p><img src=/images/vscode-extensioninstalled.png alt="We all know message boxes are the real impact ðŸ˜Ž"></p><blockquote><p><strong>Note:</strong> In my testing it was not possible to simply create a <code>./data</code> directory in the default VS Code installation folder to convert it to a portable install. Analyzing the portability source code (<a href=https://github.com/microsoft/vscode/blob/bd4ab867f9ca31105f05032cf09edbce31fc6fe3/src/bootstrap-node.ts#L163>source</a>), this appears to be because the following value evaluates to <code>False</code>:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#6ab825;font-weight:700>const</span> isPortable = !(<span style=color:#ed9d13>&#39;target&#39;</span> <span style=color:#6ab825;font-weight:700>in</span> product) &amp;&amp; fs.existsSync(portableDataPath);
</span></span></code></pre></div><p>Analyzing the flow of the logic, we can see that the <code>product</code> object is instantiated from the <code>product.json</code> file (<a href=https://github.com/microsoft/vscode/blob/main/src/bootstrap-meta.ts#L13>source</a>), which exists in the <code>./resources/app</code> folder in the installation folder. For installations that were done using the installer, this file will have a value like like <code>"target": "user"</code>, which effectively ignores our bootstrapping.</p><p>We can confirm that this is the case by removing the <code>"target"</code> line in <code>product.json</code>, and attempting to bootstrap the installation directory again. Now the bootstrapping works, and we can bootstrap into an existing VS code installation!</p></blockquote><h2 id=prevention-and-detection>Prevention and Detection</h2><p>VS Code outlines how you can <a href=https://code.visualstudio.com/docs/setup/enterprise#_group-policy-on-windows>use Windows Group Policy to configure various settings</a>, including <a href=https://code.visualstudio.com/docs/setup/enterprise#_configure-allowed-extensions>allowed extensions</a>. Doing so allows you to specify certain publishers, extensions, or even extension versions that will be allowed in your organization. This does require some setup and maintenance, but it is probably the best line of defense against all sorts of plugin-based attacks. Unfortunately there are no filters for extension prevalence or verified publishers, but the VS Code team states they are <a href=https://code.visualstudio.com/docs/setup/enterprise#_additional-policies>open to suggestions</a> if that&rsquo;s a need for your organization.</p><p>Now, I&rsquo;m no expert in terms of detection, but it seems to me like the behavior of VS Code is pretty hard to fingerprint due to the broad spectrum of use cases it has. As such, detecting uncommon child processes of <code>Code.exe</code> for example may be quite challenging - it&rsquo;s very common for Code to be spawning shells after all. Avenues of detection may be the following:</p><ul><li>Creation of a <code>./bootstrap/extensions</code> folder inside an existing VS Code installation directory</li><li>Creation of a <code>./data</code> folder inside an existing VS Code installation directory</li><li>Execution of <code>Code.exe</code> from a non-default installation directory</li><li>Creation of any <code>*.vsix</code> files from a non-Code process</li></ul><p><em>(Suggestions welcome! Feel free to share any ideas and I&rsquo;ll add them to this blog post)</em></p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://casvancooten.com/tags/vs-code/>VS Code</a></span>
<span class=tag><a href=https://casvancooten.com/tags/offensive-security/>Offensive Security</a></span>
<span class=tag><a href=https://casvancooten.com/tags/initial-access/>Initial Access</a></span>
<span class=tag><a href=https://casvancooten.com/tags/red-team/>Red Team</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
1183 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
27-02-2025
(Last updated: 28-02-2025)</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg>
<a href=https://github.com/chvancooten/chvancooten.github.io/commit/4c1e6b3269813c1afda4f80ada75adba0375cff2 target=_blank rel=noopener>4c1e6b3</a>
@ 28-02-2025</p></div><div class=pagination><div class=pagination__buttons><span class="button next"><a href=https://casvancooten.com/posts/2021/10/so-you-wanna-hack-a-bank-global-central-bank-paces-certification-review/><span class=button__text>So You Wanna Hack a Bank? 'Global Central Bank' (PACES) Certification Review</span>
<span class=button__icon>â†’</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span>
<span><a href=https://casvancooten.com/posts/index.xml target=_blank title=rss><svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span><a href=http://gohugo.io>Hugo</a> theme by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.fcdbd434c2246625085552a35f7f1945ee33873b87ad089a5d75bb128e7bc92319bc4cf5cf5e9e6683f0710d0a245f08c96f5e0238da7f43ff91975fc78fb07a.js integrity="sha512-/NvUNMIkZiUIVVKjX38ZRe4zhzuHrQiaXXW7Eo57ySMZvEz1z16eZoPwcQ0KJF8IyW9eAjjaf0P/kZdfx4+weg=="></script></body></html>
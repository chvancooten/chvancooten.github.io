<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content="map[name:Cas van Cooten]">
<meta name=description content="Introduction As a red teamer -or as a hacker in general- you&amp;rsquo;re guaranteed to run into Microsoft&amp;rsquo;s Active Directory sooner or later. Almost every major organization uses Active Directory (which we will mostly refer to as &amp;lsquo;AD&amp;rsquo;) to manage authentication and authorization of servers and workstations in their environment. It is a complex product, and managing it securely becomes increasingly difficult at scale.
It is exactly for this reason that AD is so interesting from an offensive perspective.">
<meta name=keywords content="homepage,blog,cas van cooten,security,hacking,CRTP,Active Directory,Hacking">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=https://casvancooten.com/posts/2020/10/getting-the-crtp-certification-attacking-and-defending-active-directory-course-review/>
<title>
Getting the CRTP Certification: 'Attacking and Defending Active Directory' Course Review :: Cas' Security Ramblings
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=/favicon.ico>
<meta name=msapplication-TileColor content>
<meta itemprop=name content="Getting the CRTP Certification: 'Attacking and Defending Active Directory' Course Review">
<meta itemprop=description content="Introduction As a red teamer -or as a hacker in general- you&rsquo;re guaranteed to run into Microsoft&rsquo;s Active Directory sooner or later. Almost every major organization uses Active Directory (which we will mostly refer to as &lsquo;AD&rsquo;) to manage authentication and authorization of servers and workstations in their environment. It is a complex product, and managing it securely becomes increasingly difficult at scale.
It is exactly for this reason that AD is so interesting from an offensive perspective."><meta itemprop=datePublished content="2020-10-13T00:00:00+00:00">
<meta itemprop=dateModified content="2022-02-22T20:09:33+00:00">
<meta itemprop=wordCount content="1962"><meta itemprop=image content="https://casvancooten.com/preview.png">
<meta itemprop=keywords content="CRTP,Active Directory,Hacking,">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://casvancooten.com/preview.png">
<meta name=twitter:title content="Getting the CRTP Certification: 'Attacking and Defending Active Directory' Course Review">
<meta name=twitter:description content="Introduction As a red teamer -or as a hacker in general- you&rsquo;re guaranteed to run into Microsoft&rsquo;s Active Directory sooner or later. Almost every major organization uses Active Directory (which we will mostly refer to as &lsquo;AD&rsquo;) to manage authentication and authorization of servers and workstations in their environment. It is a complex product, and managing it securely becomes increasingly difficult at scale.
It is exactly for this reason that AD is so interesting from an offensive perspective.">
<meta property="og:title" content="Getting the CRTP Certification: 'Attacking and Defending Active Directory' Course Review">
<meta property="og:description" content="Introduction As a red teamer -or as a hacker in general- you&rsquo;re guaranteed to run into Microsoft&rsquo;s Active Directory sooner or later. Almost every major organization uses Active Directory (which we will mostly refer to as &lsquo;AD&rsquo;) to manage authentication and authorization of servers and workstations in their environment. It is a complex product, and managing it securely becomes increasingly difficult at scale.
It is exactly for this reason that AD is so interesting from an offensive perspective.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://casvancooten.com/posts/2020/10/getting-the-crtp-certification-attacking-and-defending-active-directory-course-review/"><meta property="og:image" content="https://casvancooten.com/preview.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-10-13T00:00:00+00:00">
<meta property="article:modified_time" content="2022-02-22T20:09:33+00:00">
<meta property="article:published_time" content="2020-10-13 00:00:00 +0000 UTC">
</head>
<body>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>></span>
<span class=logo__text>Security Ramblings</span>
<span class=logo__cursor>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/posts/>Blog</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
10 minutes
</p>
</div>
<article>
<h1 class=post-title>
<a href=https://casvancooten.com/posts/2020/10/getting-the-crtp-certification-attacking-and-defending-active-directory-course-review/>Getting the CRTP Certification: &lsquo;Attacking and Defending Active Directory&rsquo; Course Review</a>
</h1>
<hr>
<aside id=toc>
<div class=toc-title>Table of Contents</div>
<nav id=TableOfContents>
<ul>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#the-course>The Course</a></li>
<li><a href=#the-labs>The Labs</a></li>
<li><a href=#the-exam>The Exam</a></li>
<li><a href=#crtp-preparation-tips>CRTP Preparation Tips</a></li>
</ul>
</nav>
</aside>
<hr>
<div class=post-content>
<h2 id=introduction>Introduction</h2>
<p>As a red teamer -or as a hacker in general- you&rsquo;re guaranteed to run into Microsoft&rsquo;s Active Directory sooner or later. Almost every major organization uses Active Directory (which we will mostly refer to as &lsquo;AD&rsquo;) to manage authentication and authorization of servers and workstations in their environment. It is a complex product, and managing it securely becomes increasingly difficult at scale.</p>
<p>It is exactly for this reason that AD is so interesting from an offensive perspective. Due to the scale of most AD environments, misconfigurations that allow for lateral movement or privilege escalation on a domain level are almost always present. If you can effectively identify and exploit these misconfigurations, you can compromise an entire organization without even launching an exploit at a single server. Sounds cool, right?</p>
<p>Unfortunately, as mentioned, AD is a complex product and identifying and exploiting misconfigurations in AD environments is not always trivial. Furthermore, it can be daunting to &ldquo;start with&rdquo; AD exploitation because there&rsquo;s simply so much to learn. That&rsquo;s where the <a href=https://www.pentesteracademy.com/activedirectorylab>&lsquo;Attacking and Defending Active Directory Lab&rsquo; course by PentesterAcademy</a> comes in!</p>
<p>This course will grant you the Certified Red Team Professional (CRTP) certification if you manage to best the exam, and it will set you up with a sound foundation for further AD exploitation adventures! In this blog, I will be reviewing this course based on my own experiences with it (on the date of publishing this blog I got confirmation that I passed the exam üéâ).</p>
<h2 id=the-course>The Course</h2>
<p>The course describes itself as a &ldquo;beginner friendly&rdquo; course, supported by a lab environment &ldquo;for security professionals to understand, analyze, and practice threats and attacks in a modern Active Directory Environment&rdquo;. The theoretical part of the course is comprised of 37 videos (totaling approximately 14 hours of video material), explaining the various concepts and as well as walking through the various learning goals. An overview of the video material is provided on the <a href="https://www.pentesteracademy.com/course?id=47">course page</a>.</p>
<blockquote>
<p>Keep in mind that this course is aimed at beginners, so if you&rsquo;re familiar with Windows exploitation and/or Active Directory you will know a lot of the covered contents. Still, the discussion of underlying concepts will help even experienced red teamers get a better grip on the logic behind AD exploitation.</p>
</blockquote>
<p>The course theory, though not always living up to a high quality standard in terms of presentation and slide material, excels in terms of subject matter. The discussed concepts are relevant and actionable in real-life engagements. The outline of the course is as follows.</p>
<ul>
<li>Domain Enumeration</li>
<li>Local Privilege Escalation</li>
<li>Lateral Movement</li>
<li>Domain Persistence</li>
<li>Domain Privilege Escalation</li>
<li>Cross-Forest Attacks</li>
<li>Forest Persistence</li>
<li>Detection and Defense</li>
</ul>
<p>Since I have some experience with hacking through my work and OSCP (see my earlier blog posts üôÉ), the section on privesc as well as some basic AD concepts were familiar to me. However, I was caught by surprise on how much new techniques there are to discover, especially in the domain persistence section (often overlooked!).</p>
<p>You may notice that there is only one section on detection and defense. While interesting, this is <em>not</em> the main selling point of the course. If you&rsquo;re a blue teamer looking to improve their AD defense skills, this course will help you understand the &lsquo;red&rsquo; mindset, possible configuration flaws, and to some extent how to monitor and detect attacks on these flaws. However, the exam is fully focused on red so I would say <a href="https://www.pentesteracademy.com/course?id=47">just the course</a> should suffice for most blue teamers.</p>
<p>To help you judge whether or not this course is for you, here are some of the key techniques discussed in the course. If you know all of the below, then this course is probably not for you! <em>Note, this list is not exhaustive and there are much more concepts discussed during the course.</em></p>
<ul>
<li>Domain enumeration, manual and using BloodHound (‚ô•)</li>
<li>Kerberoasting, AS-REP roasting</li>
<li>ACL-based attacks and persistence mechanisms</li>
<li>Golden- and silver ticket attacks</li>
<li>Constrained- and unconstrained delegation attacks</li>
<li>Domain trust abuse, inter- and intra-forest</li>
<li>Basic MSSQL-based lateral movement techniques</li>
<li>Basic Antivirus, AMSI, and AppLocker evasion</li>
<li>Persistence attacks, such as DCShadow, Skeleton Key, DSRM admin abuse, etc.</li>
</ul>
<h2 id=the-labs>The Labs</h2>
<p>Where this course shines, in my opinion, is the lab environment. Overall, the lab environment of this course is nothing advanced, but it&rsquo;s the most stable and accessible lab environment I&rsquo;ve seen so far. PentesterAcademy provides VPN access as well as online RDP access over Guacamole. I&rsquo;m usually not a big fan of online access, but in this instance it works really well and it makes the course that much more accessible.</p>
<p>The environment itself contains approximately 10 machines, spread over two forests and various child forests. It is explicitly <em>not</em> a challenge lab, rather PentesterAcademy describes it as a &ldquo;practice lab&rdquo;. This checks out - if you just rush through the labs it will maybe take you a couple of hours to become Enterprise Admin. If you however use them as they are designed and take multiple approaches to practicing a variety of techniques, they will net you a lot more value.</p>
<blockquote>
<p>If you are looking for a challenge lab to test your skills without as much guidance, maybe the <a href=https://help.hackthebox.eu/forindividuals/what-are-prolabs>HackTheBox Pro Labs</a> or the <a href=https://www.pentesteracademy.com/redteamlab>CRTE course</a> are more for you!</p>
</blockquote>
<p>During the course, mainly PowerShell-based tools are used for enumeration and exploitation of AD vulnerabilities (this makes sense, since the instructor is the author of <a href=https://github.com/samratashok/nishang>Nishang</a>). However, it is expressed multiple times that you are <em>not</em> bound to the tools discussed in the course - and I, too, would encourage you to use your lab time to practice a variety of tools, techniques, and even C2 frameworks. The lab is not internet-connected, but through the VPN endpoint the hosts can reach your machine (and as such, hosted files).</p>
<p>Personally, I ran through the learning objectives using the recommended, PowerShell-based, tools. I ran through the labs a second time using Cobalt Strike and .NET-based tools, which confronted me with a whole range of new challenges and learnings. Due to the accessibility of the labs, it provides a great environment to test new tools and techniques as you discover them.</p>
<h2 id=the-exam>The Exam</h2>
<p>The CRTP certification exam is not one to underestimate. It consists of five target machines, spread over multiple domains. This is not counting your student machine, on which you start with a low-privileged foothold (similar to the labs). The goal is to get command execution (not necessarily privileged) on all of the machines. Similar to OSCP, you get 24 hours to complete the practical part of the exam. After that, you get another 48 hours to complete and submit your report.</p>
<p>I experienced the exam to be in line with the course material in terms of required knowledge. That does not mean, however, that you will be able to complete the exam with <em>just</em> the tools and commands from the course! The exam will contain some interesting variants of covered techniques, and some steps that are quite well-hidden and require careful enumeration. That said, the course itself provides a good foundation for the exam, and if you ran through all the learning objectives and -more importantly- understand the covered concepts, you will be more than likely good to go.</p>
<p>In total, the exam took me 7 hours to complete. Machines #2 and #3 in my version of the exam took me the most time due to some tooling issues and very extensive required enumeration, respectively. Otherwise, the path to exploitation was pretty clear, and exploiting identified misconfigurations is fairly straightforward for the most part. As such, I think the 24 hours should be enough to compromise the labs if you spent enough time preparing. Additionally, I read online that it is not necessarily required to compromise all five machines, but I wouldn&rsquo;t bet on this as PentesterAcademy is not very transparent on the passing requirements!</p>
<p>The exam requires a report, for which I reflected <a href=https://cas.vancooten.com/posts/2020/05/generating-pretty-pwk-reports-with-pandoc-and-markdown-templates-inside/>my reporting strategy for OSCP</a>. I prepared the overall report template beforehand (based on my <a href=https://github.com/chvancooten/OSCP-MarkdownReportingTemplates>PWK reporting templates</a>), and used a wireframe Markdown template to keep notes as I went. After completing the exam, I finalized my notes, merged them into the master document, converted it to Word format using Pandoc, and spend about 30 minutes styling my report (I&rsquo;m a perfectionist, I know). Overall, the full exam cost me 10 hours, including reporting and some breaks.</p>
<p>I can obviously not include my report as an example, but the Table of Contents looked as follows.</p>
<p><img src=/images/crtp-report.png alt="PWK Lab Progression"></p>
<h2 id=crtp-preparation-tips>CRTP Preparation Tips</h2>
<p>So, you&rsquo;ve decided to take the plunge and register for CRTP? Cool! Please find below some of my tips that will help you prepare for, and hopefully nail, the CRTP certification (and beyond). As always, don&rsquo;t hesitate to reach out <a href=https://twitter.com/chvancooten>on Twitter</a> if you have some unanswered questions or concerns. Always happy to help!</p>
<ul>
<li><strong>Choose the right timing:</strong> Even though this course is specifically for beginners, it may not be the most suitable course to start your hacking career with (depending on your desired career path). General exploitation and hacking handicraft are not covered as much as they are with e.g. OSCP, as the course focuses solely on AD exploitation (with a <em>very</em> brief primer on local privilege escalation for Windows). However, if you are a beginning red teamer looking to get a better track record with AD, this course is likely a step in the right direction. Obviously, there&rsquo;s no right order in which to take courses, just think about your current skillset and desired development path, then decide if this course fits the bill.</li>
<li><strong>Enrich the theory:</strong> Even though the videos and course guide do a good job of walking you through the various subjects, I can always recommend doing your own research in addition to the provided videos. Reading e.g. blogs on tools and techniques that you use will greatly help improve your insight and help actualize your skills even more.</li>
<li><strong>Get comfortable in the labs:</strong> Depending on the amount of lab time you have, there&rsquo;s probably no rush. The CRTP course is doable in about one month, but that does not mean you should limit your lab time to 30 days. I would recommend getting more time, especially if you want to research techniques and play around in the labs on your own to try out your new hacking toys in a safe environment.</li>
<li><strong>Create a cheat sheet:</strong> You will find yourself using a lot of similar commands during the course and exam. As such, it&rsquo;s useful to create a list of your favorite and most-used commands, so you can simply copy and paste without looking up the syntax every time. Furthermore, a structured cheat sheet will help you ensure that you don&rsquo;t overlook anything in your enumeration, something that is <em>very</em> important for CRTP.</li>
<li><strong>Prepare your report beforehand:</strong> Even though CRTP gives you 48 hours to come up with a report, creating a report template will help you mentally prepare for the exam as well as structure your as-you-go notes in advance. Doing this will prevent you having to do a lot of writing and note adaptation after you finished your exam.</li>
</ul>
<p><strong>So&mldr; Where&rsquo;s that cheat sheet?</strong></p>
<p>As you may have guessed based on the above, I compiled a cheat sheet and command reference based on the theory discussed during CRTP. I enriched this with some commands I personally use a lot for AD enumeration and exploitation.</p>
<p>I will publish this cheat sheet on this blog, but since I&rsquo;m set to do CRTE (the <a href=https://www.pentesteracademy.com/redteamlab>Red Teaming Labs</a> offered by PentesterAcademy) soon, I will hold off publishing my cheat sheet until after this so that I can aggregate and finalize the listed commands and techniques. If you&rsquo;re hungry for cheat sheets in the meantime, <a href=https://cas.vancooten.com/posts/2020/05/oscp-cheat-sheet-and-command-reference/>you can find my OSCP cheat sheet here</a>. Watch this space for more soon!</p>
</div>
</article>
<hr>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://casvancooten.com/tags/crtp/>CRTP</a></span>
<span class=tag><a href=https://casvancooten.com/tags/active-directory/>Active Directory</a></span>
<span class=tag><a href=https://casvancooten.com/tags/hacking/>Hacking</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
1962 Words
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
13-10-2020
(Last updated: 22-02-2022)
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg>
<a href=7cbc6db5d409b09dcd74dafef99c2761d5bb7cdb target=_blank rel=noopener>7cbc6db</a>
@ 22-02-2022
</p>
</div>
<div class=pagination>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://casvancooten.com/posts/2020/11/windows-active-directory-exploitation-cheat-sheet-and-command-reference/>
<span class=button__icon>‚Üê</span>
<span class=button__text>Windows & Active Directory Exploitation Cheat Sheet and Command Reference</span>
</a>
</span>
<span class="button next">
<a href=https://casvancooten.com/posts/2020/05/try-harder-yet-another-journey-to-oscp/>
<span class=button__text>Try Harder: Yet Another Journey To OSCP</span>
<span class=button__icon>‚Üí</span>
</a>
</span>
</div>
</div>
</main>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=footer__content>
<span><a href=https://casvancooten.com></a></span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span>
<span><a href=https://casvancooten.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span>
</div>
</div>
<div class=footer__inner>
<div class=footer__content>
<span><a href=http://gohugo.io>Hugo</a> theme by <a href=https://github.com/rhazdon>rhazdon</a></span>
</div>
</div>
</footer>
</div>
<script type=text/javascript src=/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>
</body>
</html>